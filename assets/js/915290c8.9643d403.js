"use strict";(self.webpackChunkten_docs=self.webpackChunkten_docs||[]).push([[1203],{2459:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var i=t(5893),a=t(1151);const o={sidebar_position:4},r="Migrate your dApp to Ten",s={id:"introduction/developer-quickstart",title:"Migrate your dApp to Ten",description:'Migrating to Ten is a straightforward process that immediately unlocks "Programmable Encryption".',source:"@site/docs/introduction/developer-quickstart.md",sourceDirName:"introduction",slug:"/introduction/developer-quickstart",permalink:"/docs/introduction/developer-quickstart",draft:!1,unlisted:!1,editUrl:"https://github.com/ten-protocol/ten-documentation/blob/main/docs/introduction/developer-quickstart.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Technology",permalink:"/docs/introduction/technology"},next:{title:"Getting started",permalink:"/docs/category/getting-started"}},l={},c=[{value:"1. Configuring Hardhat",id:"1-configuring-hardhat",level:2},{value:"1.1 Installing the Ten Hardhat Plugin",id:"11-installing-the-ten-hardhat-plugin",level:3},{value:"1.2 Configuring <code>hardhat.config.js</code> for the Ten Testnet",id:"12-configuring-hardhatconfigjs-for-the-ten-testnet",level:3},{value:"Step 1: Declaring a Public Variable",id:"step-1-declaring-a-public-variable",level:2},{value:"Code:",id:"code",level:3},{value:"Explanation:",id:"explanation",level:3},{value:"Step 2: Transitioning to a Private Variable with a Getter Function",id:"step-2-transitioning-to-a-private-variable-with-a-getter-function",level:2},{value:"Code:",id:"code-1",level:3},{value:"Explanation:",id:"explanation-1",level:3},{value:"Step 3: Implementing Data Access Control",id:"step-3-implementing-data-access-control",level:2},{value:"Code:",id:"code-2",level:3},{value:"Explanation:",id:"explanation-2",level:3},{value:"Step 4: Emitting Events - Default visibility",id:"step-4-emitting-events---default-visibility",level:2},{value:"Code:",id:"code-3",level:3},{value:"Explanation:",id:"explanation-3",level:3},{value:"Step 5: Emitting Events - Configuring visibility",id:"step-5-emitting-events---configuring-visibility",level:2},{value:"Code:",id:"code-4",level:3},{value:"Explanation:",id:"explanation-4",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"migrate-your-dapp-to-ten",children:"Migrate your dApp to Ten"}),"\n",(0,i.jsx)(n.p,{children:'Migrating to Ten is a straightforward process that immediately unlocks "Programmable Encryption".'}),"\n",(0,i.jsx)(n.p,{children:"There are a couple of changes you need to make:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Change your hardhat deployment script so that you can use ",(0,i.jsx)(n.code,{children:"--network ten"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Add logic to your view functions to protect data (if needed)."}),"\n",(0,i.jsx)(n.li,{children:"Configure event log visibility (if needed)."}),"\n",(0,i.jsx)(n.li,{children:"Add a widget to your javascript UI to onboard Ten users."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"1-configuring-hardhat",children:"1. Configuring Hardhat"}),"\n",(0,i.jsx)(n.p,{children:"To begin building on Ten, you can start by setting up a Hardhat project as usual."}),"\n",(0,i.jsx)(n.h3,{id:"11-installing-the-ten-hardhat-plugin",children:"1.1 Installing the Ten Hardhat Plugin"}),"\n",(0,i.jsx)(n.p,{children:"To integrate the Ten Network into your Hardhat project, install the ten-hardhat-plugin:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install ten-hardhat-plugin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Note: Plugins can be installed using ",(0,i.jsx)(n.code,{children:"npm"})," or ",(0,i.jsx)(n.code,{children:"yarn"}),"."]}),"\n",(0,i.jsxs)(n.h3,{id:"12-configuring-hardhatconfigjs-for-the-ten-testnet",children:["1.2 Configuring ",(0,i.jsx)(n.code,{children:"hardhat.config.js"})," for the Ten Testnet"]}),"\n",(0,i.jsxs)(n.p,{children:["Open ",(0,i.jsx)(n.code,{children:"hardhat.config.js"})," in your project's root directory and configure it in the following way:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-javascript",children:'import {HardhatUserConfig} from "hardhat/config";\nimport "@nomiclabs/hardhat-waffle";\nimport \'ten-hardhat-plugin\'\n\nmodule.exports = {\n  solidity: "0.8.10",\n  networks: {\n    hardhat: {\n        // Configuration for the Hardhat Network\n    },\n    ten: {\n        url: "https://testnet.ten.xyz/v1/", \n        chainId: 443, \n        accounts: ["your-private-key"],\n    },\n  },\n};\n\nexport default config;\n'})}),"\n",(0,i.jsx)(n.p,{children:"Now, you can start writing or migrating the smart contracts."}),"\n",(0,i.jsx)(n.h1,{id:"2-writing-smart-contracts",children:"2. Writing Smart Contracts"}),"\n",(0,i.jsx)(n.p,{children:"Ten performs bytecode execution in the EVM identically to Ethereum, allowing developers to leverage their existing codebase and tools."}),"\n",(0,i.jsx)(n.p,{children:'The main difference is that, during execution, private variables and the internal state of the contract are hidden from everyone, including node operators and the sequencer.\nThis is a major advantage that represents "Programmable Privacy".'}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"In Ten, the internal node database is encrypted, and the execution itself is also encrypted inside the TEE."})}),"\n",(0,i.jsxs)(n.p,{children:["The calls to ",(0,i.jsx)(n.a,{href:"https://docs.alchemy.com/reference/eth-getstorageat",children:"getStorageAt"})," are disabled by default, so all data access will be performed through view functions which are under the control of the smart contract developer. Note that public variables are accessible to everyone because Solidity automatically generates a getter function for them."]}),"\n",(0,i.jsx)(n.p,{children:"We'll illustrate how this works by creating a simple data storage example. In this dApp, users can store a number and retrieve it later."}),"\n",(0,i.jsx)(n.h2,{id:"step-1-declaring-a-public-variable",children:"Step 1: Declaring a Public Variable"}),"\n",(0,i.jsx)(n.h3,{id:"code",children:"Code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"// SPDX-License-Identifier: MIT\npragma solidity ^0.8.0;\n\ncontract StorageExample {\n    mapping(address => uint256) public storedValues;\n\n    function storeValue(uint256 value) public {\n        storedValues[tx.origin] = value;\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"explanation",children:"Explanation:"}),"\n",(0,i.jsxs)(n.p,{children:["In this step, we've declared a public variable ",(0,i.jsx)(n.code,{children:"storedValues"}),". Solidity automatically generates a public getter view function for it, so on both Ethereum and Ten, you can call this view function without any restrictions. We also created a function that allows users to store a value against their address."]}),"\n",(0,i.jsx)(n.h2,{id:"step-2-transitioning-to-a-private-variable-with-a-getter-function",children:"Step 2: Transitioning to a Private Variable with a Getter Function"}),"\n",(0,i.jsx)(n.h3,{id:"code-1",children:"Code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:"contract StorageExample {\n    mapping(address => uint256) private _storedValues;\n\n    function storeValue(uint256 value) public {\n        _storedValues[tx.origin] = value;\n    }\n    \n    function getValue(address account) public view returns (uint256) {\n        return _storedValues[account];\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"explanation-1",children:"Explanation:"}),"\n",(0,i.jsxs)(n.p,{children:["We've now made our data variable private, meaning it can't be accessed directly from outside the contract. To fetch its value, we've provided a custom public view function ",(0,i.jsx)(n.code,{children:"getValue"})," where the user provides the address. On both Ethereum and Ten, if you call this function you will retrieve the number stored by that address."]}),"\n",(0,i.jsx)(n.admonition,{type:"caution",children:(0,i.jsxs)(n.p,{children:["In Ethereum, the ",(0,i.jsx)(n.code,{children:"_storedValues"})," variable can also be accessed directly using the ",(0,i.jsx)(n.code,{children:"getStorageAt"})," method, but not in Ten."]})}),"\n",(0,i.jsx)(n.h2,{id:"step-3-implementing-data-access-control",children:"Step 3: Implementing Data Access Control"}),"\n",(0,i.jsxs)(n.p,{children:["In this step, we aim to restrict users to only access their own value. This feature can only be implemented in Ten because as mentioned above, ",(0,i.jsx)(n.code,{children:"_storedValues"})," is not hidden in Ethereum."]}),"\n",(0,i.jsx)(n.h3,{id:"code-2",children:"Code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'contract StorageExample {\n    mapping(address => uint256) private _storedValues;\n\n    function storeValue(uint256 value) public {\n        _storedValues[tx.origin] = value;\n    }\n\n    function getValue(address account) public view returns (uint256) {\n        require(tx.origin == account, "Not authorized!");\n        return _storedValues[account];\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"explanation-2",children:"Explanation:"}),"\n",(0,i.jsxs)(n.p,{children:["Since ",(0,i.jsx)(n.code,{children:"getValue"})," is the only function which exposes the values, we can add a check like this: ",(0,i.jsx)(n.code,{children:'require(tx.origin == account, "Not authorized!");'})," If anyone, other than the original account, asks for the value, they will get an error."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["In Ethereum, since all data is accessible anyway, there is no need to sign calls to view functions, so ",(0,i.jsx)(n.code,{children:"tx.origin"})," can be spoofed."]})}),"\n",(0,i.jsxs)(n.p,{children:['In Ten, the platform ensures that calls to view functions are authenticated, which means that behind the scenes, there is a "Viewing Key" signature of the ',(0,i.jsx)(n.code,{children:"tx.origin"})," address."]}),"\n",(0,i.jsx)(n.h2,{id:"step-4-emitting-events---default-visibility",children:"Step 4: Emitting Events - Default visibility"}),"\n",(0,i.jsx)(n.p,{children:"Events in Ethereum are crucial for UIs to react to smart contract state changes. In this step, we'll emit an event when a user stores a value. We'll also gauge the popularity of our contract by emitting an event when certain milestones are reached."}),"\n",(0,i.jsx)(n.h3,{id:"code-3",children:"Code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'contract StorageExample {\n    mapping(address => uint256) private _storedValues;\n    uint256 private totalCalls = 0;\n\n    event DataChanged(address indexed account, uint256 newValue);\n    event MilestoneReached(uint256 noStoredValues);\n\n    function storeValue(uint256 value) public {\n        _storedValues[tx.origin] = value;\n        emit DataChanged(tx.origin, value);\n        totalCalls++;\n        if (totalCalls % 1000 == 0) {\n            emit MilestoneReached(totalCalls);\n        }\n    }\n\n    function getValue(address account) public view returns (uint256) {\n        require(tx.origin == account, "Not authorized!");\n        return _storedValues[account];\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"explanation-3",children:"Explanation:"}),"\n",(0,i.jsxs)(n.p,{children:["On Ethereum, events are visible to anyone. For example, you can subscribe to the ",(0,i.jsx)(n.code,{children:"DataChanged"})," event and receive notifications in real time about the data of everyone else."]}),"\n",(0,i.jsxs)(n.p,{children:["The programmable encryption of Ten allows you full control over visibility but also has sensible defaults.\nEvent logs can be queried using ",(0,i.jsx)(n.code,{children:"eth_getLogs"})," or subscribed to using the ",(0,i.jsx)(n.code,{children:"logs"})," endpoint. Both these calls are authenticated, and the platform makes sure to return only visible logs."]}),"\n",(0,i.jsx)(n.p,{children:"In our case, the requirements are very simple and common sense:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"DataChanged"})," event is specific to an account, so it should only be received by that user."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MilestoneReached"}),", on the other hand, is intended for everyone, as we want to show how popular our contract is."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The behaviour you desire is to restrict the visibility of ",(0,i.jsx)(n.code,{children:"DataChanged"}),", but not that of ",(0,i.jsx)(n.code,{children:"MilestoneReached"}),". ",(0,i.jsx)(n.strong,{children:"Which is exactly how it works by default!"})]}),"\n",(0,i.jsx)(n.p,{children:"Default behaviour:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DataChanged"})," - has an address as a topic (an indexed field), which instructs the platform that the event log is only visible to that address."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MilestoneReached"})," - has no address topic which by default means it is visible to everyone."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"All you have to do is emit events as usual, and the platform applies common-sense visibility rules."}),"\n",(0,i.jsx)(n.h2,{id:"step-5-emitting-events---configuring-visibility",children:"Step 5: Emitting Events - Configuring visibility"}),"\n",(0,i.jsx)(n.p,{children:"Once you prepare your application for production, you will want explicit control over the event visibility."}),"\n",(0,i.jsx)(n.h3,{id:"code-4",children:"Code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-solidity",children:'interface ContractTransparencyConfig {\n    enum Field {\n        TOPIC1, TOPIC2, TOPIC3,\n        SENDER,  // tx.origin - msg.sender\n        EVERYONE // the event is public - visible to everyone\n    }\n\n    enum ContractCfg {\n        TRANSPARENT, // internal state via getStorageAt is accessible to everyone, all events are public\n        PRIVATE      // internal state is hidden, and events can be configured individually\n    }\n\n    struct EventLogConfig {\n        bytes32 eventSignature; // the event signature hash\n        Field[] visibleTo;      // list of fields denoting who can see the event when private\n    }\n\n    struct VisibilityConfig {\n        ContractCfg contractCfg;\n        EventLogConfig[] eventLogConfigs;\n    }\n\n    function visibilityRules() external pure returns (VisibilityConfig memory);\n}\n\ncontract StorageExample is ContractTransparencyConfig{\n    mapping(address => uint256) private _storedValues;\n    uint256 private totalCalls = 0;\n\n    event DataChanged(address indexed account, uint256 newValue);\n    event MilestoneReached(uint256 noStoredValues);\n\n    function storeValue(uint256 value) public {\n        _storedValues[tx.origin] = value;\n        emit DataChanged(tx.origin, value);\n        totalCalls++;\n        if (totalCalls % 1000 == 0) {\n            emit MilestoneReached(totalCalls);\n        }\n    }\n\n    function getValue(address account) public view returns (uint256) {\n        require(tx.origin == account, "Not authorized!");\n        return _storedValues[account];\n    }\n\n    function visibilityRules() external pure override returns (VisibilityConfig memory) {\n        EventLogConfig[]  memory eventLogConfigs = new EventLogConfig[](2);\n\n        // the signagure of "event DataChanged(address indexed account, uint256 newValue);"\n        bytes32 dataChangedEventSig = hex"0xec851d5c322f7f1dd5581f7432e9f6683a8709a4b1ca754ccb164742b82a7d2f";\n        Field[]  memory relevantTo = new Field[](2);\n        relevantTo[0] = Field.TOPIC1;\n        relevantTo[1] = Field.SENDER;\n        eventLogConfigs[0] = EventLogConfig(dataChangedEventSig, relevantTo);\n\n        // the signagure of "event MilestoneReached(uint256 noStoredValues);"\n        bytes32 milestoneReachedEventSig = hex"0xd41033274424d56dd572e7196fb4230cf4141d546b91fc00555cab8403965924";\n        Field[]  memory relevantTo = new Field[](1);\n        relevantTo[0] = Field.EVERYONE;\n        eventLogConfigs[1] = EventLogConfig(milestoneReachedEventSig, relevantTo);\n\n        return VisibilityConfig(ContractCfg.PRIVATE, eventLogConfigs);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"explanation-4",children:"Explanation:"}),"\n",(0,i.jsxs)(n.p,{children:["By implementing the ",(0,i.jsx)(n.code,{children:"ContractTransparencyConfig.visibilityRules"})," method you can configure the visibility concerns of the current contract."]}),"\n",(0,i.jsxs)(n.p,{children:["A ",(0,i.jsx)(n.code,{children:"ContractCfg.PUBLIC"})," contract behaves exactly like a contract deployed on Ethereum. The storage slots are exposed, and all contracts are public."]}),"\n",(0,i.jsxs)(n.p,{children:['For private contracts, you can configure the visibility of each individual event type you\'re emitting by specifying the "fields" that can receive it.\n',(0,i.jsx)(n.code,{children:"Field.EVERYONE"})," means that this is a public event."]})]})}function u(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>r});var i=t(7294);const a={},o=i.createContext(a);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);